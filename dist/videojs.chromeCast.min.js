/*! videojs-chromeCast - v0.1.0 - 2013-09-20
* https://github.com/benjipott/videojs-chromeCast
* Copyright (c) 2013 Pott Benjamin; Licensed MIT */

vjs.plugin.merge=function(){var a=vjs.obj.merge.apply(this,arguments);if(a.hasOwnProperty("userAgentAllowed")&&a.enabled){a.userAgentAllowed=a.userAgentAllowed.split(",");for(var b=0,c=a.userAgentAllowed;b<c.length;b++){var d=new RegExp(c[b],"i");if(a.enabled=!!vjs.USER_AGENT.match(d),a.enabled)break}}return a},function(){var a={enabled:!0,appId:"your-chromecast-app-id",namespace:"your-namesapace",title:"",description:""};vjs.plugin("chromecast",function(b){var c=vjs.plugin.merge(a,b);return c.enabled?(this.chromeCastComponent=new vjs.ChromeCastComponent(this,c),void 0):!1})}();var cast=cast||{};vjs.Player.prototype.chromeCastComponent={},vjs.ChromeCastComponent=vjs.TextTrackButton.extend({init:function(a,b,c){vjs.TextTrackButton.call(this,a,b,c),a.controls()||this.disable(),this.hide(),cast&&cast.isAvailable?this.initializeApi():(window.addEventListener("message",vjs.bind(this,this.windowsMessage)),"undefined"!=typeof window.cast&&window.cast.isAvailable&&this.initializeApi(),this.onReceiverList([{name:"Receiver 1"},{name:"receiver 2"}]))}}),vjs.ChromeCastComponent.prototype.kind_="chromecast",vjs.ChromeCastComponent.prototype.buttonText="Chromecast",vjs.ChromeCastComponent.prototype.className="vjs-chromecast-button",vjs.ChromeCastComponent.prototype.receiver,vjs.ChromeCastComponent.prototype.cast_api,vjs.ChromeCastComponent.prototype.cv_activity,vjs.ChromeCastComponent.prototype.windowsMessage=function(a){a.source==window&&a.data&&"CastApi"==a.data.source&&"Hello"==a.data.event&&this.initializeApi()},vjs.ChromeCastComponent.prototype.initializeApi=function(){vjs.log("ChromeCastComponent initializeApi"),this.cast_api=new cast.Api,this.cast_api.addReceiverListener("YouTube",vjs.bind(this,this.onReceiverList))},vjs.ChromeCastComponent.prototype.onReceiverList=function(a){vjs.log("ChromeCastComponent onReceiverList"),this.populateMenu(a,this.player_)},vjs.ChromeCastComponent.prototype.doLaunch=function(){this.stopPlayback(),vjs.log("Cast video : "+this.player_.currentSrc());var a=new cast.LaunchRequest(this.options_.appId,this.receiver);a.parameters="v=abcdefg",a.description=new cast.LaunchDescription,a.description.text=this.player_.options_.description,a.description.url="...",this.cast_api.launch(a,vjs.bind(this,this.onLaunch))},vjs.ChromeCastComponent.prototype.onLaunch=function(a){if("running"==a.status){vjs.log("Chromecast running"),this.cv_activity=a;var b=this.extractUrl();this.playVideo(b,{},!0,this.options_.title)}else"error"==a.status&&(vjs.log("error lunch chromecast"),this.cv_activity=null)},vjs.ChromeCastComponent.prototype.extractUrl=function(){return this.player_.currentSrc()},vjs.ChromeCastComponent.prototype.playVideo=function(a,b,c,d){var e=new cast.MediaLoadRequest(a);e.contentInfo=b,e.autoplay=c,e.title=d,vjs.log("loadMedia:",e),this.cast_api.loadMedia(this.cv_activity.activityId,e,vjs.bind(this,this.mediaLoaded)),vjs.log("post load media")},vjs.ChromeCastComponent.prototype.mediaLoaded=function(a){vjs.log("mediaLoaded callback:",a);var b=cast.MediaPlayRequest();this.cast_api.playMedia(this.cv_activity.activityId,b,vjs.bind(this,this.mediaPlaying))},vjs.ChromeCastComponent.prototype.mediaPlaying=function(a){vjs.log("mediaPlaying callback:",a)},vjs.ChromeCastComponent.prototype.stopPlayback=function(){this.cv_activity&&this.cast_api.stopActivity(this.cv_activity.activityId,function(){})},vjs.ChromeCastComponent.prototype.createEl=function(){var a=vjs.TextTrackButton.prototype.createEl.call(this,"div");return this.player_.controlBar.el_.appendChild(a),a},vjs.ChromeCastComponent.prototype.populateMenu=function(a,b){var c=this.menu,d=this.items=[];vjs.obj.each(a,function(a,e){if(e){var f=new vjs.ChromeCastComponentMenuItem(b,e);d.push(f),c.addItem(f)}}),this.items.length>0&&this.show()},vjs.ChromeCastComponent.prototype.createMenu=function(){var a=this.menu=new vjs.Menu(this.player_);return this.items=[],a.el_.appendChild(vjs.createEl("li",{className:"vjs-menu-title",tabindex:-1})),this.items.length>0&&this.show(),a},vjs.ChromeCastComponentMenuItem=vjs.MenuItem.extend({init:function(a,b){vjs.MenuItem.call(this,a,b)}}),vjs.ChromeCastComponentMenuItem.prototype.createEl=function(a,b){return vjs.Button.prototype.createEl.call(this,"li",vjs.obj.merge({className:"vjs-menu-item",innerHTML:this.options_.name},b))},vjs.ChromeCastComponentMenuItem.prototype.onClick=function(){vjs.MenuItem.prototype.onClick.call(this),this.player_.chromeCastComponent.receiver=this.options_,this.player_.chromeCastComponent.doLaunch()};